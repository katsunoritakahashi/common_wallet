<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LKBSFQGWRN"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LKBSFQGWRN');
</script>
<div class="container mt-70">
  <div class="row">
    <div class="col">
      <h2 class="border-bottom"><%= "#{current_user.name}の家計簿" %></h2>
      <h5>
        <% if @month.present? %>
          <%= @month.month.strftime("%-m月の家計簿") %>
          <%= link_to month_details_path(@month.id) do %>
           <i class="fas fa-arrow-circle-right fa-lg"></i>
          <% end %>
        <% else %>
          <%= @month.month.strftime("%-m月の家計簿") %>
          <%= link_to months_path do %>
           <i class="fas fa-arrow-circle-right fa-lg"></i>
          <% end %> 
        <% end %>
      </h5>
      <% if @month.present? %>
        <table class="text-center table lg">
          <tr class="table-warning">
            <th>月初残高</th>
            <th>月末予定残高</th>
            <th>精算未済</th>
          </tr>
          <tr class="table-light">
            <td><%= "#{@month.balance.to_s(:delimited)}円" %></td>
            <td><%= "#{@month.balance_last.to_s(:delimited) }円" %></td>
            <td>
            <% if @not_yet_count.blank? %>
              無し
            <% elsif @not_yet_count == 0 %>
              0件
            <% else %>
              <%= link_to "#{@not_yet_count}件", new_month_detail_path(@month.id) %>
            <% end %>
            </td>
          </tr>
        </table>
      <% else %>
        <p>　今月の家計簿が登録されていません</p>
      <% end %>

      <h5>
        <% if @detail.present? && @budget.present? %>
          <%= @month.month.strftime("%-m月に使ったお金") %>
          <%= link_to month_budgets_path(@month.id) do %>
           <i class="fas fa-arrow-circle-right fa-lg"></i>
          <% end %> 
        <% elsif !@detail.present? && @month.present? %>
          <%= @month.month.strftime("%-m月に使ったお金") %>
          <%= link_to month_details_path(@month.id) do %>
           <i class="fas fa-arrow-circle-right fa-lg"></i>
          <% end %> 
        <% else %>
          <%= @month.month.strftime("%-m月に使ったお金") %>
          <%= link_to months_path do %>
           <i class="fas fa-arrow-circle-right fa-lg"></i>
          <% end %> 
        <% end %>
      </h5>
      <% if @month.present? && @detail.present? %>
        <%= pie_chart @pie_chart,library: {title: {text: "支出<br> #{@spending_total.to_s(:delimited)}円"}} %>
      <% else %>
        <p>　今月はまだ支出がありません。</p>
      <% end %>

      <h5>口座残高
        <%= link_to months_path do %>
          <i class="fas fa-arrow-circle-right fa-lg"></i>
        <% end %> 
      </h5>
      <% if @months.present? %>
        <% if @colum_chart_max > 10000 %>
          <%= column_chart @column_chart.map { |month, balance_last| [month.strftime('%-m月'), balance_last / 10000] }, colors: ['#ffc107'], suffix: "万円" %>
        <% else %>
          <%= column_chart @column_chart.map { |month, balance_last| [month.strftime('%-m月'), balance_last] }, colors: ['#ffc107'], suffix: "円" %>
        <% end %>
      <% else %>
        <p>　家計簿が登録されていません</p>
      <% end %>
    </div>
  </div>
</div>
