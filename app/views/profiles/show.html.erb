<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LKBSFQGWRN"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LKBSFQGWRN');
</script>
<div class="container mt-70">
  <div class="row">
    <div class="col">
      <h2 class="border-bottom"><%= "#{current_user.name}の家計簿" %></h2>

        <% if @month.present? %>
          <%= link_to month_details_path(@month.id) do %>
            <div class="white-box bottom-shadow">
              <h5 class="text-left black"><%= @month.month.strftime("%-m月の家計簿") %></h5>
              <table class="table black fs-15">
                <tr>
                  <td class="block-center"><span class="left">口座残高</span></td>
                  <td><span class="text-left"><%= "#{@month.balance_last.to_s(:delimited) }円" %></span></td>
                </tr>
                <tr>
                  <td class="block-center"><span class="left">前月比</span></td>
                  <td>
                    <% if @month.balance < @month.balance_last %>
                      <span class="default-blue"><%= "+#{(@month.balance_last - @month.balance).to_s(:delimited)}円 " %><i class="fas fa-thumbs-up"></i></span>
                    <% elsif @month.balance == @month.balance_last %>
                      -
                    <% else %>
                      <span class="red"><%= "#{(@month.balance_last - @month.balance).to_s(:delimited)}円 " %><i class="fas fa-fire"></i></span>
                    <% end %>
                  </td>
                </tr>
                <tr>
                  <td class="block-center"><span class="left">未精算</span></td>
                  <td>
                  <% if @not_yet_count.blank? %>
                    無し
                  <% elsif @not_yet_count == 0 %>
                    0件
                  <% else %>
                    <%= link_to "#{@not_yet_count}件", new_month_detail_path(@month.id) %>
                  <% end %>
                  </td>
                </tr>
              </table>
            </div>
          <% end %>
        <% else %>
          <%= link_to months_path do %>
            <div class="white-box bottom-shadow">
              <h5 class="text-left black">今月の家計簿</h5>
              <p>　今月の家計簿が登録されていません</p>
            </div>
          <% end %>
        <% end %>
        <div class="box">
          <% if @detail.present? && @budget.present? %>
            <%= link_to month_budgets_path(@month.id) do %>
              <div class="white-box bottom-shadow pt-30 col-md-5 width">
                <h5 class="text-left black"><%= @month.month.strftime("%-m月に使ったお金") %></h5>
                <%= pie_chart @pie_chart,library: {title: {text: "支出<br> #{@spending_total.to_s(:delimited)}円"}} %>
              </div>
            <% end %>
          <% else %>
            <%= link_to months_path do %>
              <div class="white-box bottom-shadow pt-30 col-md-5 width">
                <h5 class="text-left black">今月に使ったお金</h5>
                <p>　今月はまだ支出がありません。</p>
              </div>
            <% end %>
          <% end %>
          <%= link_to months_path do %>
            <div class="white-box bottom-shadow pt-30 col-md-6 width right">
              <h5 class="text-left black">口座残高</h5>
              <% if @months.present? %>
                <% if @colum_chart_max > 10000 %>
                  <%= column_chart @column_chart.map { |month, balance_last| [month.strftime('%-m月'), balance_last / 10000] }, colors: ['#ffc107'], suffix: "万円" %>
                <% else %>
                  <%= column_chart @column_chart.map { |month, balance_last| [month.strftime('%-m月'), balance_last] }, colors: ['#ffc107'], suffix: "円" %>
                <% end %>
              <% else %>
                <p>　家計簿が登録されていません</p>
              <% end %>
            </div>
          <% end %> 
        </div>
    </div>
  </div>
</div>
